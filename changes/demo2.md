# Changes

Code differences compared to source project demokratos.

## Makefile (+33 -2)

```diff
@@ -13,6 +13,9 @@
 else
 	INTERNAL_PROTO_FILES=$(shell find internal -name *.proto)
 	API_PROTO_FILES=$(shell find api -name *.proto)
+	#这就是新增的内容
+	#想把第三方的这些也收集下来，再使用命令生成第三方包（因为自动生成好像不是很好使）
+	THIRD_PARTY_GOOGLE_API_PROTO_FILES=$(shell find third_party/google/api -name *.proto)
 endif
 
 .PHONY: init
@@ -22,7 +25,7 @@
 	go install google.golang.org/grpc/cmd/protoc-gen-go-grpc@latest
 	go install github.com/go-kratos/kratos/cmd/kratos/v2@latest
 	go install github.com/go-kratos/kratos/cmd/protoc-gen-go-http/v2@latest
-	go install github.com/go-kratos/kratos/cmd/protoc-gen-go-errors/v2@latest
+	go install github.com/orzkratos/errgenkratos/cmd/protoc-gen-orzkratos-errors@latest
 	go install github.com/google/gnostic/cmd/protoc-gen-openapi@latest
 	go install github.com/google/wire/cmd/wire@latest
 
@@ -51,7 +54,7 @@
 	protoc --proto_path=./api \
 		   --proto_path=./third_party \
 		   --go_out=paths=source_relative:./api \
-		   --go-errors_out=paths=source_relative:./api \
+		   --orzkratos-errors_out=include_nested=true,separate_named=true,paths=source_relative:./api \
 		   $(API_PROTO_FILES)
 
 .PHONY: build
@@ -72,6 +75,34 @@
 	make errors;
 	make config;
 	make generate;
+
+# 这就是新增的内容
+# npm install -g @protobuf-ts/plugin
+web_api_grpc_ts:
+	mkdir -p ./bin/web_api_grpc_ts.out
+	PROTOC_GEN_TS=$$(which protoc-gen-ts) && \
+	protoc \
+	--plugin=protoc-gen-ts=$$PROTOC_GEN_TS \
+	--ts_out=./bin/web_api_grpc_ts.out \
+	--proto_path=./api \
+	--proto_path=./third_party \
+	$(API_PROTO_FILES)
+
+	PROTOC_GEN_TS=$$(which protoc-gen-ts) && \
+	protoc \
+	--plugin=protoc-gen-ts=$$PROTOC_GEN_TS \
+	--ts_out=./bin/web_api_grpc_ts.out \
+	--proto_path=./third_party \
+	$(THIRD_PARTY_GOOGLE_API_PROTO_FILES)
+
+# 这就是新增的内容
+# go install github.com/orzkratos/vue3kratos/cmd/vue3orzkratos@latest
+web_api_grpt_ts:
+	vue3orzkratos gen-grpc-via-http-in-root --grpc-ts-root=./bin/web_api_grpc_ts.out
+
+# 这就是新增的内容
+web_api_cleanup:
+	rm -rf ./bin/web_api_grpc_ts.out
 
 # show help
 help:
```

## api/helloworld/v1/error_reason_errors.pb.go (+12 -36)

```diff
@@ -1,10 +1,10 @@
-// Code generated by protoc-gen-go-errors. DO NOT EDIT.
+// Code generated by protoc-gen-orzkratos-errors (errgenkratos). DO NOT EDIT.
 
 package v1
 
 import (
-	fmt "fmt"
 	errors "github.com/go-kratos/kratos/v2/errors"
+	newerk "github.com/orzkratos/errkratos/newerk"
 )
 
 // This is a compile-time assertion to ensure that this generated file
@@ -12,61 +12,37 @@
 const _ = errors.SupportPackageIsVersion1
 
 func IsUnknown(err error) bool {
-	if err == nil {
-		return false
-	}
-	e := errors.FromError(err)
-	return e.Reason == ErrorReason_UNKNOWN.String() && e.Code == 500
+	return newerk.IsError(err, ErrorReason_UNKNOWN, 500)
 }
 
 func ErrorUnknown(format string, args ...interface{}) *errors.Error {
-	return errors.New(500, ErrorReason_UNKNOWN.String(), fmt.Sprintf(format, args...))
+	return newerk.NewError(500, ErrorReason_UNKNOWN, format, args...)
 }
-
 func IsUserNotFound(err error) bool {
-	if err == nil {
-		return false
-	}
-	e := errors.FromError(err)
-	return e.Reason == ErrorReason_USER_NOT_FOUND.String() && e.Code == 404
+	return newerk.IsError(err, ErrorReason_USER_NOT_FOUND, 404)
 }
 
 func ErrorUserNotFound(format string, args ...interface{}) *errors.Error {
-	return errors.New(404, ErrorReason_USER_NOT_FOUND.String(), fmt.Sprintf(format, args...))
+	return newerk.NewError(404, ErrorReason_USER_NOT_FOUND, format, args...)
 }
-
 func IsGreeterUnspecified(err error) bool {
-	if err == nil {
-		return false
-	}
-	e := errors.FromError(err)
-	return e.Reason == ErrorReason_GREETER_UNSPECIFIED.String() && e.Code == 500
+	return newerk.IsError(err, ErrorReason_GREETER_UNSPECIFIED, 500)
 }
 
 func ErrorGreeterUnspecified(format string, args ...interface{}) *errors.Error {
-	return errors.New(500, ErrorReason_GREETER_UNSPECIFIED.String(), fmt.Sprintf(format, args...))
+	return newerk.NewError(500, ErrorReason_GREETER_UNSPECIFIED, format, args...)
 }
-
 func IsTxError(err error) bool {
-	if err == nil {
-		return false
-	}
-	e := errors.FromError(err)
-	return e.Reason == ErrorReason_TX_ERROR.String() && e.Code == 500
+	return newerk.IsError(err, ErrorReason_TX_ERROR, 500)
 }
 
 func ErrorTxError(format string, args ...interface{}) *errors.Error {
-	return errors.New(500, ErrorReason_TX_ERROR.String(), fmt.Sprintf(format, args...))
+	return newerk.NewError(500, ErrorReason_TX_ERROR, format, args...)
 }
-
 func IsDbError(err error) bool {
-	if err == nil {
-		return false
-	}
-	e := errors.FromError(err)
-	return e.Reason == ErrorReason_DB_ERROR.String() && e.Code == 500
+	return newerk.IsError(err, ErrorReason_DB_ERROR, 500)
 }
 
 func ErrorDbError(format string, args ...interface{}) *errors.Error {
-	return errors.New(500, ErrorReason_DB_ERROR.String(), fmt.Sprintf(format, args...))
+	return newerk.NewError(500, ErrorReason_DB_ERROR, format, args...)
 }
```

## cmd/demo2kratos/main.go (+31 -0)

```diff
@@ -7,11 +7,13 @@
 	"github.com/go-kratos/kratos/v2"
 	"github.com/go-kratos/kratos/v2/config"
 	"github.com/go-kratos/kratos/v2/config/file"
+	"github.com/go-kratos/kratos/v2/encoding/json"
 	"github.com/go-kratos/kratos/v2/log"
 	"github.com/go-kratos/kratos/v2/middleware/tracing"
 	"github.com/go-kratos/kratos/v2/transport/grpc"
 	"github.com/go-kratos/kratos/v2/transport/http"
 	"github.com/orzkratos/demokratos/demo2kratos/internal/conf"
+	"github.com/orzkratos/errkratos/newerk"
 	"github.com/yyle88/done"
 	"github.com/yyle88/must"
 	"github.com/yyle88/rese"
@@ -29,6 +31,35 @@
 
 func init() {
 	flag.StringVar(&flagconf, "conf", "./configs", "config path, eg: -conf config.yaml")
+
+	// Configure JSON field naming style for HTTP responses
+	// UseProtoNames=true uses exact proto field names, UseProtoNames=false uses lowerCamelCase
+	// Recommended to keep default false to work across different languages
+	// This avoids extra configuration in other language clients
+	//
+	// 配置 HTTP 响应的 JSON 字段命名风格
+	// UseProtoNames=true 使用 proto 定义的原始字段名，UseProtoNames=false 使用小写驼峰命名
+	// 推荐保持默认 false 以确保跨语言兼容性
+	// 这样可以避免在其他语言客户端中进行额外配置
+	json.MarshalOptions.UseProtoNames = false // Use lowerCamelCase to work across different languages // 使用小写驼峰命名确保跨语言兼容性
+
+	// Set UseEnumNumbers to true to serialize enums as numbers instead of strings
+	// This matches TypeScript generated code from proto, ensuring frontend works correct
+	// Frontend receives numeric enum values that match proto definitions
+	//
+	// 设置 UseEnumNumbers 为 true 使枚举序列化为数字而非字符串
+	// 这与 proto 生成的 TypeScript 代码保持一致，确保前端兼容性
+	// 前端接收的枚举数值与 proto 定义匹配
+	json.MarshalOptions.UseEnumNumbers = true // Return enums as numbers to match TypeScript generated code // 返回枚举数字以匹配 TypeScript 生成代码
+
+	// Set metadata field name to pass numeric enum value to frontend
+	// Kratos error reason is string, but frontend TypeScript uses numeric enum
+	// This field bridges the gap by storing numeric value in error metadata
+	//
+	// 设置 metadata 字段名用于传递枚举数值给前端
+	// Kratos 错误 reason 是字符串，但前端 TypeScript 使用数字枚举
+	// 此字段通过在错误 metadata 中存储数值来桥接这个差异
+	newerk.SetReasonCodeFieldName("numeric_reason_code_enum") // Store numeric error code for frontend enum matching // 存储数字错误码以匹配前端枚举
 }
 
 func newApp(logger log.Logger, gs *grpc.Server, hs *http.Server) *kratos.App {
```

## internal/pkg/generate/generate_vue3client.go (+1 -0)

```diff
@@ -0,0 +1 @@
+package generate
```

## internal/pkg/generate/generate_vue3client_test.go (+34 -0)

```diff
@@ -0,0 +1,34 @@
+package generate
+
+import (
+	"os"
+	"path/filepath"
+	"testing"
+
+	"github.com/orzkratos/demokratos/demo2kratos"
+	"github.com/orzkratos/vue3kratos"
+	"github.com/yyle88/eroticgo"
+	"github.com/yyle88/must"
+	"github.com/yyle88/osexec"
+	"github.com/yyle88/osexistpath/osmustexist"
+	"github.com/yyle88/rese"
+)
+
+//go:generate go test -v -run ^TestGenerateVue3Client$
+func TestGenerateVue3Client(t *testing.T) {
+	sourceRoot := demo2kratos.SourceRoot()
+	t.Log(sourceRoot)
+
+	clientRoot := filepath.Join(sourceRoot, "bin", "web_api_grpc_ts.out")
+	t.Log(clientRoot)
+	must.Done(os.RemoveAll(clientRoot))
+
+	execConfig := osexec.NewExecConfig().WithPath(sourceRoot).WithDebug()
+	out := rese.A1(execConfig.Exec("make", "web_api_grpc_ts"))
+	t.Log(string(out))
+	osmustexist.MustRoot(clientRoot)
+
+	vue3kratos.GenGrpcViaHttpInRoot(clientRoot)
+
+	eroticgo.GREEN.ShowMessage("vue3client code:", clientRoot, "generate success")
+}
```

